<!DOCTYPE html> 
<html> 
	<head> 
	<title>Page Title</title> 
	
	<meta name="viewport" content="width=device-width, initial-scale=1"> 

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0-rc.2/jquery.mobile-1.1.0-rc.2.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.1.0-rc.2/jquery.mobile-1.1.0-rc.2.min.js"></script>
	<script type="text/javascript" src="farbtastic.js"></script>
	<link rel="stylesheet" href="farbtastic.css" type="text/css" />
	<link rel="stylesheet" href="OfficeDuino.css" type="text/css" />
	<script>
	
	    var ODdata;
	    var RGB=new Array();
	    RGB[0]= 0;
	    RGB[1]= 0;
	    RGB[2]= 0;
    	var HSL=new Array();
    	HSL[0]= 0;
    	HSL[1]= 0;
    	HSL[2]= 0;
    	
		var relaisCpu;
		var relaisVer;
		var relaisK;
		var relaisT;
		var fetK;
		var fetT;
    
    	var ALL = 1;
	    	
	    var url = "http://192.168.0.203/i";	
	    	
	    
	    
	    function callback(data) {
	    	ODdata = data;
	        console.log(ODdata);
	        var r = ODdata.fetRood;
	        var g = ODdata.fetGroen;
	        var b = ODdata.fetBlauw;
	        relaisCpu = ODdata.relaisCpu;
	        relaisVer = ODdata.relaisVer;
	        relaisK = ODdata.relaisK;
	        relaisT = ODdata.relaisT;
	        fetK = ODdata.fetK;
	        fetT = ODdata.fetT;
	        ALL = ODdata.totaal;
	        HSL = rgbToHsl(r,g,b);
	        Setter();
	    }
	    
	    function Setter() {
	    	switch (relaisCpu) {
	    		case '0':
	    					break;
	    		case '1':
	    					break;
	    	}
	    	switch (relaisVer) {
	    		case '0':
	    					break;
	    		case '1':
	    					break;
	    	}
	    	switch (relaisK) {
	    		case '0':	$("#StroomK").prop("checked",false).checkboxradio("refresh");
	    					break;
	    		case '1':	$("#StroomK").prop("checked",true).checkboxradio("refresh");
	    					break;
	    	}
	    	switch (relaisT) {
	    		case '0':
	    					break;
	    		case '1':
	    					break;
	    	}
	    	switch (fetK) {
	    		case '0':
	    					break;
	    		case '1':
	    					break;
	    	}
	    	switch (fetT) {
	    		case '0':
	    					break;
	    		case '1':
	    					break;
	    	}
	    	switch (ALL) {
	    		case '0':
	    					break;
	    		case '1':
	    					break;
	    	}
	    	$.farbtastic('#colorpicker').setColor(HSL);
	    }
	    
	    function hslToRgb(h, s, l){
	        var r, g, b;
	    
	        if(s == 0){
	            r = g = b = l; // achromatic
	        }else{
	            function hue2rgb(p, q, t){
	                if(t < 0) t += 1;
	                if(t > 1) t -= 1;
	                if(t < 1/6) return p + (q - p) * 6 * t;
	                if(t < 1/2) return q;
	                if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
	                return p;
	            }
	    
	            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
	            var p = 2 * l - q;
	            r = hue2rgb(p, q, h + 1/3);
	            g = hue2rgb(p, q, h);
	            b = hue2rgb(p, q, h - 1/3);
	        }
	    
	        return [r * 255, g * 255, b * 255];
	    }
	    
	    
	    function rgbToHsl(r, g, b){
	        r /= 255, g /= 255, b /= 255;
	        var max = Math.max(r, g, b), min = Math.min(r, g, b);
	        var h, s, l = (max + min) / 2;
	    
	        if(max == min){
	            h = s = 0; // achromatic
	        }else{
	            var d = max - min;
	            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
	            switch(max){
	                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
	                case g: h = (b - r) / d + 2; break;
	                case b: h = (r - g) / d + 4; break;
	            }
	            h /= 6;
	        }
	    
	        return [h, s, l];
	    }
	    
	    function MakeUrl() {
	    	if (fetK == 1 || fetT == 1 || RGB[0] !== 0 || RGB[1] !== 0 || RGB[2] !== 0) {
	    		relaisCpu = 1;
	    	}
	    	else {
	    		relaisCpu = 0;
	    	}
	    	var x = "http://192.168.0.203/s?a="+relaisCpu+"&b="+relaisVer+"&c="+relaisK+"&d="+relaisT+"&e="+fetK+"&f="+fetT+"&g="+ Math.round(RGB[0]) +"&h="+ Math.round(RGB[1]) +"&i="+ Math.round(RGB[2]) +"&j="+1;
	    	return x;
	    }
	    
	    
	    
	    
	    function Send(a) {
	    	$.getScript(a,function () {
	    	})
	    }
		    
		$(function () {
			
			
			
			
			
			
			function SetAmbient(){
				var x = $('#ambientOI');
				x[0].selectedIndex = 1;
				x.slider('refresh');
			}
			
			$('#VerSlider').change(function () {
				var x = $(this);
				var y = x[0].selectedIndex == 1 ? true:false;
				if(y){
					relaisVer = 1;
				} else {
					relaisVer = 0;
				}
				Send(MakeUrl());
			});
			
			$('#Kdesk').change(function () {
				var x = $(this);
				var y = x[0].selectedIndex == 1 ? true:false;
				if(y){
					relaisK = 1;
				} else {
					relaisK = 0;;
				}
				Send(MakeUrl());
			});
			
			$('#Klight').change(function () {
				var x = $(this);
				var y = x[0].selectedIndex == 1 ? true:false;
				if(y){
					fetK = 1;
				} else {
					fetK = 0;;
				}
				Send(MakeUrl());
			});
			$('#Tdesk').change(function () {
				var x = $(this);
				var y = x[0].selectedIndex == 1 ? true:false;
				if(y){
					relaisT = 1;
				} else {
					relaisT = 0;
				}
				Send(MakeUrl());
			});
			$('#Tlight').change(function () {
				var x = $(this);
				var y = x[0].selectedIndex == 1 ? true:false;
				if(y){
					fetT = 1;
				} else {
					fetT = 0;
				}

				Send(MakeUrl());
			});
			
			$('#ambientOI').change(function () {
				var x = $(this);
				var y = x[0].selectedIndex == 1 ? true:false;
				if(y){
					$('#colorpicker').click();
				} else {
					RGB[0] = 0;
					RGB[1] = 0;
					RGB[2] = 0;
				}
				Send(MakeUrl());
			});			
			
			$('#colorpicker').farbtastic(function () { 
				var a = $.farbtastic('#colorpicker').hsl; 
				RGB = hslToRgb(a[0],a[1],a[2]);
				if (RGB[0] != 0 && RGB[1] != 0 && RGB[2] != 0){
					SetAmbient();
				}
			});
			
			$('#colorpicker').mouseup(function () {Send(MakeUrl())})			
			Send(url);
		})
	</script>
</head> 

<body> 
<div data-role="page">

	<div data-role="header">
		<h1><img src="AppSaloon_logo.png" /><div>OfficeDuino</div></h1>
	</div><!-- /header -->

	<div data-role="content" data-theme="a" data-content-theme="a">
		<div class="ui-grid-a">	
			<div class="ui-block-a">
				<h2>Controller: Koen</h2>
				 <div class="containing-element ui-field-contain">
				 	<select name="slider" id="Kdesk" data-role="slider">
				 		<option value="off">Desk power ON</option>
				 		<option value="on">Desk power OFF</option>
				 	</select>
				 </div>
				 <div class="containing-element ui-field-contain">
				 	<select name="slider" id="Klight" data-role="slider">
				 		<option value="off">Desk light ON</option>
				 		<option value="on">Desk light OFF</option>
				 	</select>
				 </div> 
			</div>
			<div class="ui-block-b">
				<h2>Controller: Toon</h2>
				<div class="containing-element  ui-field-contain">
					<select name="slider" id="Tdesk" data-role="slider">
						<option value="off">Desk power ON</option>
						<option value="on">Desk power OFF</option>
					</select>
				</div>
				<div class="containing-element  ui-field-contain">
					<select name="slider" id="Tlight" data-role="slider">
						<option value="off">Desk light ON</option>
						<option value="on">Desk light OFF</option>
					</select>
				</div>
			</div>
		</div>
		<div>
			<h2>Controller: General</h2>
			<div data-role="collapsible" data-iconpos="right" data-collapsed="false">
				<h2>Ambient light controller</h2>
				<div class="ui-grid-a">
					<div class="ui-block-a">
						<div id="colorpicker"></div>
					</div>
					<div class="ui-block-b" >
						<div class="containing-element ui-field-contain">
							<select name="slider" id="ambientOI" data-role="slider">
								<option value="0">On</option>
								<option value="1">Off</option>
							</select>
						</div>
						<fieldset data-role="controlgroup">
							<input type="checkbox" name="rood" id="rood" class="custom" value="255"/>
								   <label for="rood">Red</label>
							<input type="checkbox" name="green" id="green" class="custom" value="255"/>
								   <label for="green">Green</label>
						   <input type="checkbox" name="blue" id="blue" class="custom" value="255"/>
						   	   <label for="blue">Blue</label>
						</fieldset>
					</div>
				</div>
			</div>
			<div data-role="collapsible" data-iconpos="right" data-collapsed="false">
				<h2>Amp Controller</h2>
				<div class="containing-element ui-field-contain">
					<select name="slider" id="VerSlider" data-role="slider">
						<option value="off">On</option>
						<option value="on">Off</option>
					</select>
				</div> 
			</div>
		</div>
	</div><!-- /content -->
	<div data-role="footer">
		<h4>2012 &copy; appsaloon</h4>
	</div><!-- /footer -->
</div><!-- /page -->
</body>
</html>